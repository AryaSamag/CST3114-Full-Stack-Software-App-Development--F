<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CST3144 Lesson Booking System</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-graduation-cap"></i>
                    Lesson Booking System
                </a>
                <div class="navbar-nav">
                    <button class="btn btn-outline" onclick="showLessons()">
                        <i class="fas fa-list"></i>
                        Lessons
                    </button>
                    <button class="btn btn-outline cart-btn" onclick="showCart()">
                        <i class="fas fa-shopping-cart"></i>
                        Cart
                        <span id="cart-badge" class="badge" style="display: none;">0</span>
                    </button>
                </div>
            </div>
        </nav>
        <!-- Lessons Page -->
        <div id="lessons-page" class="container page-container">
            <!-- Search and Sort Controls -->
            <div class="controls-row">
                <div class="control-item search-control">
                    <div class="input-group">
                        <span class="input-group-icon"><i class="fas fa-search"></i></span>
                        <input type="text" id="search-input" class="form-control" placeholder="Search lessons..." oninput="performSearch()">
                    </div>
                </div>
                <div class="control-item">
                    <select id="sort-by" class="form-control" onchange="sortLessons()">
                        <option value="subject">Sort by Subject</option>
                        <option value="location">Sort by Location</option>
                        <option value="price">Sort by Price</option>
                        <option value="spaces">Sort by Availability</option>
                    </select>
                </div>
                <div class="control-item">
                    <select id="sort-order" class="form-control" onchange="sortLessons()">
                        <option value="asc">Ascending</option>
                        <option value="desc">Descending</option>
                    </select>
                </div>
                <div class="control-item results-info">
                    <i class="fas fa-info-circle"></i>
                    <span id="results-count">0</span> lessons found
                </div>
            </div>
        <!-- Lessons Grid -->
            <div class="lessons-grid">
                <div v-for="lesson in sortedLessons" :key="lesson.id" class="lesson-card">
                    <div class="lesson-icon">
                        <i :class="lesson.icon"></i>
                    </div>
                    <h3>{{ lesson.subject }}</h3>
                    <div class="lesson-info">
                        <i class="fas fa-map-marker-alt"></i> Location: <strong>{{ lesson.location }}</strong>
                    </div>
                    <div class="price">
                        <i class="fas fa-tag"></i> Price: AED {{ lesson.price }}
                    </div>
                    <div class="lesson-info">
                        <i class="fas fa-users"></i> Availability: 
                        <strong>{{ lesson.spaces }} {{ lesson.spaces === 1 ? 'space' : 'spaces' }}</strong>
                    </div>
                    <button 
                        class="add-btn" 
                        @click="addToCart(lesson)"
                        :disabled="lesson.spaces === 0">
                        <i class="fas fa-cart-plus"></i>
                        {{ lesson.spaces > 0 ? 'Add to Cart' : 'Out of Stock' }}
                    </button>
                </div>
            </div>
        </div>

        <!-- Cart View -->
        <div v-else class="cart-view">
            <div class="cart-header">
                <h2><i class="fas fa-shopping-cart"></i> Shopping Cart</h2>
                <button class="back-btn" @click="toggleCart">
                    <i class="fas fa-arrow-left"></i> Back to Lessons
                </button>
            </div>

            <div v-if="cart.length > 0">
                <!-- Cart Items -->
                <div v-for="item in cart" :key="item.id" class="cart-item">
                    <div class="cart-item-info">
                        <h3>{{ item.subject }}</h3>
                        <div class="cart-item-details">
                            {{ item.location }} â€¢ AED {{ item.price }} per lesson
                        </div>
                    </div>
                    <div class="cart-item-right">
                        <div class="quantity">Qty: {{ item.quantity }}</div>
                        <button class="remove-btn" @click="removeFromCart(item)">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </div>
                </div>

                <!-- Checkout Form -->
                <div class="checkout-section">
                    <h3>Checkout Information</h3>
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input 
                            type="text" 
                            v-model="checkoutForm.name"
                            @input="validateForm"
                            :class="{ error: checkoutForm.nameError }"
                            placeholder="Enter your full name">
                        <div v-if="checkoutForm.nameError" class="error-message">
                            {{ checkoutForm.nameError }}
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Phone Number *</label>
                        <input 
                            type="text" 
                            v-model="checkoutForm.phone"
                            @input="validateForm"
                            :class="{ error: checkoutForm.phoneError }"
                            placeholder="Enter your phone number">
                        <div v-if="checkoutForm.phoneError" class="error-message">
                            {{ checkoutForm.phoneError }}
                        </div>
                    </div>
                    <button 
                        class="checkout-btn" 
                        @click="submitOrder"
                        :disabled="!isFormValid || cart.length === 0">
                        <i class="fas fa-check-circle"></i> Complete Order (AED {{ totalPrice }})
                    </button>
                </div>

                <div v-if="orderSubmitted" class="success-message">
                    <i class="fas fa-check-circle"></i> Order submitted successfully! Thank you for your purchase.
                </div>
            </div>
            <div v-else class="empty-cart">
                <i class="fas fa-shopping-cart"></i>
                <h3>Your cart is empty</h3>
                <p>Add some lessons to get started!</p>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    lessons: [
                        {
                            id: 1,
                            subject: 'Mathematics',
                            location: 'Dubai',
                            price: 100,
                            spaces: 5,
                            icon: 'fas fa-calculator'
                        },
                        {
                            id: 2,
                            subject: 'English',
                            location: 'Abu Dhabi',
                            price: 80,
                            spaces: 5,
                            icon: 'fas fa-book'
                        },
                        {
                            id: 3,
                            subject: 'Science',
                            location: 'Sharjah',
                            price: 90,
                            spaces: 5,
                            icon: 'fas fa-flask'
                        },
                        {
                            id: 4,
                            subject: 'History',
                            location: 'Al Ain',
                            price: 95,
                            spaces: 5,
                            icon: 'fas fa-landmark'
                        },
                        {
                            id: 5,
                            subject: 'Geography',
                            location: 'Dubai',
                            price: 85,
                            spaces: 5,
                            icon: 'fas fa-globe'
                        },
                        {
                            id: 6,
                            subject: 'Physics',
                            location: 'Abu Dhabi',
                            price: 110,
                            spaces: 5,
                            icon: 'fas fa-atom'
                        },
                        {
                            id: 7,
                            subject: 'Chemistry',
                            location: 'Sharjah',
                            price: 105,
                            spaces: 5,
                            icon: 'fas fa-vial'
                        },
                        {
                            id: 8,
                            subject: 'Biology',
                            location: 'Al Ain',
                            price: 95,
                            spaces: 5,
                            icon: 'fas fa-dna'
                        },
                        {
                            id: 9,
                            subject: 'Computer Science',
                            location: 'Dubai',
                            price: 120,
                            spaces: 5,
                            icon: 'fas fa-laptop-code'
                        },
                        {
                            id: 10,
                            subject: 'Art',
                            location: 'Abu Dhabi',
                            price: 75,
                            spaces: 5,
                            icon: 'fas fa-palette'
                        }
                    ],
                    cart: [],
                    showCart: false,
                    sortBy: 'subject',
                    sortOrder: 'asc',
                    searchQuery: '',
                    filteredLessons: [],
                    checkoutForm: {
                        firstName: '',
                        lastName: '',
                        address: '',
                        city: '',
                        state: '',
                        zip: '',
                        method: 'home',
                        sendGift: false,
                        giftPhone: '',
                        phone: '',
                        firstNameError: '',
                        lastNameError: '',
                        phoneError: '',
                        giftPhoneError: ''
                    },
                    orderSubmitted: false
                };
            },
            computed: {
                sortedLessons() {
                    let lessons = this.searchQuery ? this.filteredLessons : this.lessons;

                    return [...lessons].sort((a, b) => {
                        let aVal = a[this.sortBy];
                        let bVal = b[this.sortBy];

                        // Convert to numbers for numeric comparison
                        if (this.sortBy === 'price' || this.sortBy === 'spaces') {
                            aVal = Number(aVal);
                            bVal = Number(bVal);
                        } else {
                            // Convert to lowercase for string comparison
                            aVal = String(aVal).toLowerCase();
                            bVal = String(bVal).toLowerCase();
                        }

                        if (this.sortOrder === 'asc') {
                            return aVal > bVal ? 1 : -1;
                        } else {
                            return aVal < bVal ? 1 : -1;
                        }
                    });
                },
                 cartItemCount() {
                    return this.cart.reduce((total, item) => total + item.quantity, 0);
                },
                totalPrice() {
                    return this.cart.reduce((total, item) => total + (item.price * item.quantity), 0).toFixed(2);
                },
                isFormValid() {
                    // Basic required checks: first & last name and buyer phone.
                    const baseValid = this.checkoutForm.firstName &&
                                      this.checkoutForm.lastName &&
                                      this.checkoutForm.phone &&
                                      !this.checkoutForm.firstNameError &&
                                      !this.checkoutForm.lastNameError &&
                                      !this.checkoutForm.phoneError;

                    // If sending as gift, require gift phone and no error
                    if (this.checkoutForm.sendGift) {
                        return baseValid && this.checkoutForm.giftPhone && !this.checkoutForm.giftPhoneError;
                    }

                    return baseValid;
                }
            },
        },      

